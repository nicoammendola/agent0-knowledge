# ERC-8004 v1.0 SDK Update Guide

This document outlines all changes required to update the Agent0 TypeScript SDK to be compatible with ERC-8004 v1.0 (January 2026).

---

## Table of Contents

1. [Executive Summary](#executive-summary)
2. [Registration Flow Changes](#registration-flow-changes)
3. [Agent Wallet Changes](#agent-wallet-changes)
4. [Feedback Flow Changes](#feedback-flow-changes)
5. [File-by-File Analysis](#file-by-file-analysis)
6. [Migration Guide](#migration-guide)

---

## Executive Summary

### Breaking Changes in v1.0

| Change                                                     | Impact             | Priority    |
|------------------------------------------------------------|--------------------|-------------|
| **IPFS now optional** - On-chain data URI supported        | New feature needed | ğŸŸ¡ HIGH     |
| **Parameter renames** - `tokenURI` â†’ `agentURI`            | ABI + code updates | ğŸ”´ CRITICAL |
| **`agentWallet` is RESERVED** - Cannot use `setMetadata()` | Breaking change    | ğŸ”´ CRITICAL |
| **`feedbackAuth` removed** - No pre-authorization needed   | Simplification     | ğŸ”´ CRITICAL |
| **Tags changed** - `bytes32` â†’ `string`                    | ABI + code updates | ğŸ”´ CRITICAL |
| **New `endpoint` field** in feedback                       | New parameter      | ğŸŸ¡ HIGH     |
| **New `URIUpdated` event**                                 | Event handling     | ğŸŸ¢ MEDIUM   |

---

## Registration Flow Changes

### NEW: Three Storage Options

v1.0 introduces flexibility in where the registration file is stored:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    v1.0 REGISTRATION OPTIONS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  OPTION 1: IPFS (Current Default)                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  1. register() â†’ mint NFT, get agentId                                      â”‚
â”‚  2. Upload JSON to IPFS â†’ get CID                                           â”‚
â”‚  3. setAgentURI(agentId, "ipfs://QmXyz...")                                 â”‚
â”‚                                                                             â”‚
â”‚  Pros: Decentralized, immutable, cheap updates                              â”‚
â”‚  Cons: Requires IPFS provider, extra step                                   â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  OPTION 2: HTTP (Existing Alternative)                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  1. Host JSON at https://myagent.com/registration.json                      â”‚
â”‚  2. register("https://myagent.com/registration.json") â†’ mint + link         â”‚
â”‚                                                                             â”‚
â”‚  Pros: Simple, single transaction, familiar                                 â”‚
â”‚  Cons: Centralized, mutable, domain dependency                              â”‚
â”‚                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  OPTION 3: ON-CHAIN DATA URI (NEW in v1.0)                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  1. Base64-encode your registration JSON                                    â”‚
â”‚  2. register("data:application/json;base64,eyJ0eXBlIjoi...") â†’ mint + link  â”‚
â”‚                                                                             â”‚
â”‚  Pros: Fully on-chain, no external dependencies, permanent                  â”‚
â”‚  Cons: Gas costs for large files, updates cost gas                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Parameter Renames

| Old (Current SDK) | New (v1.0)        |
|-------------------|-------------------|
| `tokenURI`        | `agentURI`        |
| `setTokenURI()`   | `setAgentURI()`   |
| `_setTokenURI()`  | (internal change) |

### New Events

```solidity
// NEW in v1.0 - emitted when agentURI is updated
event URIUpdated(uint256 indexed agentId, string newURI, address indexed updatedBy)

// UPDATED - parameter renamed
event Registered(uint256 indexed agentId, string agentURI, address indexed owner)
// Was: event Registered(uint256 indexed agentId, string tokenURI, address indexed owner)
```

### Contract Function Signatures

```solidity
// Registration functions (parameter renamed)
function register(string agentURI, MetadataEntry[] calldata metadata) external returns (uint256 agentId)
function register(string agentURI) external returns (uint256 agentId)
function register() external returns (uint256 agentId)

// URI update function (renamed from setTokenURI)
function setAgentURI(uint256 agentId, string calldata newURI) external
```

### SDK Changes Required for Registration

#### 1. Add `registerOnChain()` Method

```typescript
// NEW METHOD in agent.ts
async registerOnChain(): Promise<RegistrationFile> {
  // Validate basic info
  if (!this.registrationFile.name || !this.registrationFile.description) {
    throw new Error('Agent must have name and description before registration');
  }

  // Build ERC-8004 compliant JSON (same as IPFS flow)
  const registrationJson = this._buildRegistrationJson();
  
  // Base64 encode
  const jsonString = JSON.stringify(registrationJson);
  const base64 = Buffer.from(jsonString).toString('base64');
  const dataUri = `data:application/json;base64,${base64}`;
  
  // Collect metadata (excluding agentWallet - RESERVED in v1.0!)
  const metadataEntries = this._collectMetadataForRegistration();
  // IMPORTANT: Filter out 'agentWallet' - it's reserved now
  const filteredMetadata = metadataEntries.filter(e => e.key !== 'agentWallet');
  
  // Single transaction
  const txHash = await this.sdk.web3Client.transactContract(
    this.sdk.getIdentityRegistry(),
    'register',
    {},
    dataUri,
    filteredMetadata
  );
  
  const receipt = await this.sdk.web3Client.waitForTransaction(txHash);
  const agentId = this._extractAgentIdFromReceipt(receipt);
  
  const chainId = await this.sdk.chainId();
  this.registrationFile.agentId = `${chainId}:${agentId}`;
  this.registrationFile.agentURI = dataUri;
  
  return this.registrationFile;
}
```

#### 2. Rename `setAgentUri()` Method

```typescript
// RENAME in agent.ts (was setAgentUri, contract function renamed)
async setAgentURI(agentUri: string): Promise<void> {
  if (!this.registrationFile.agentId) {
    throw new Error('Agent must be registered before setting URI');
  }

  const { tokenId } = parseAgentId(this.registrationFile.agentId);
  await this.sdk.web3Client.transactContract(
    this.sdk.getIdentityRegistry(),
    'setAgentURI',  // Was 'setAgentUri' or 'setTokenURI'
    {},
    BigInt(tokenId),
    agentUri
  );

  this.registrationFile.agentURI = agentUri;
}
```

#### 3. Update `registerIPFS()` Method

```typescript
// UPDATE in agent.ts - use new function name
async registerIPFS(): Promise<RegistrationFile> {
  // ... existing logic ...
  
  // Change this line:
  // OLD: await this.sdk.web3Client.transactContract(..., 'setAgentUri', ...)
  // NEW:
  await this.sdk.web3Client.transactContract(
    this.sdk.getIdentityRegistry(),
    'setAgentURI',  // Renamed function
    {},
    BigInt(tokenId),
    `ipfs://${ipfsCid}`
  );
  
  // ... rest of logic ...
}
```

---

## Agent Wallet Changes

### The Problem

In v1.0, `agentWallet` is a **RESERVED** metadata key with special rules:

1. **Cannot** be set via `setMetadata()` 
2. **Cannot** be set during `register()`
3. Initially defaults to the **owner's address**
4. Can only be changed via `setAgentWallet()` with an **EIP-712 signature**
5. **Resets to zero address** on ownership transfer

### Current SDK (BROKEN)

```typescript
// âŒ CURRENT - Won't work in v1.0
setAgentWallet(address: Address, chainId: number): this {
  this.registrationFile.walletAddress = address;
  this.registrationFile.walletChainId = chainId;
  
  // This marks it to be set via setMetadata() - WILL FAIL IN V1.0!
  if (address !== this._lastRegisteredWallet) {
    this._dirtyMetadata.add('agentWallet');
  }
  
  return this;
}
```

### v1.0 Required Implementation

```typescript
// âœ… NEW - Separate async method with signature
async setAgentWallet(newWallet: Address, deadline: number): Promise<this> {
  if (!this.registrationFile.agentId) {
    throw new Error('Agent must be registered before setting wallet');
  }
  
  const { tokenId } = parseAgentId(this.registrationFile.agentId);
  
  // Create EIP-712 signature proving control of newWallet
  const signature = await this._signAgentWalletChange(
    BigInt(tokenId),
    newWallet,
    BigInt(deadline)
  );
  
  // Call the new contract method
  await this.sdk.web3Client.transactContract(
    this.sdk.getIdentityRegistry(),
    'setAgentWallet',
    {},
    BigInt(tokenId),
    newWallet,
    BigInt(deadline),
    signature
  );
  
  // Update local state
  this.registrationFile.walletAddress = newWallet;
  
  return this;
}

// Helper method for EIP-712 signing
private async _signAgentWalletChange(
  agentId: bigint,
  newWallet: string,
  deadline: bigint
): Promise<string> {
  // The signature must come from the newWallet address
  // This proves the caller controls the new wallet
  
  const domain = {
    name: 'ERC8004IdentityRegistry',
    version: '1',
    chainId: await this.sdk.chainId(),
    verifyingContract: await this.sdk.getIdentityRegistry().getAddress(),
  };
  
  const types = {
    SetAgentWallet: [
      { name: 'agentId', type: 'uint256' },
      { name: 'newWallet', type: 'address' },
      { name: 'deadline', type: 'uint256' },
    ],
  };
  
  const value = {
    agentId: agentId,
    newWallet: newWallet,
    deadline: deadline,
  };
  
  // Sign with the wallet that will become the new agentWallet
  return await this.sdk.web3Client.signTypedData(domain, types, value);
}
```

### New Contract Function

```solidity
// Added to Identity Registry ABI
function setAgentWallet(
  uint256 agentId, 
  address newWallet, 
  uint256 deadline, 
  bytes calldata signature
) external

function getAgentWallet(uint256 agentId) external view returns (address)
```

### Migration Notes

- The old `setAgentWallet(address, chainId)` method should be **removed**
- `agentWallet` should NOT be included in `_collectMetadataForRegistration()`
- The wallet address is NO LONGER stored in the registration file on IPFS
- It's now a first-class on-chain attribute

---

## Feedback Flow Changes

### feedbackAuth Removed

The entire pre-authorization system is removed in v1.0:

| Component                     | Action                    |
|-------------------------------|---------------------------|
| `signFeedbackAuth()` method   | **DELETE**                |
| `encodeFeedbackAuth()` method | **DELETE**                |
| `_stringToBytes32()` helper   | **DELETE**                |
| `_bytes32ToTags()` helper     | **DELETE**                |
| `feedbackAuth` parameter      | **REMOVE from all calls** |

### Tag Type Changes

All tag parameters change from `bytes32` to `string`:

| Function          | Old                          | New                        |
|-------------------|------------------------------|----------------------------|
| `giveFeedback`    | `bytes32 tag1, bytes32 tag2` | `string tag1, string tag2` |
| `readFeedback`    | returns `bytes32, bytes32`   | returns `string, string`   |
| `readAllFeedback` | returns `bytes32[]`          | returns `string[]`         |
| `getSummary`      | `bytes32 tag1, bytes32 tag2` | `string tag1, string tag2` |

### New `endpoint` Field

v1.0 adds an `endpoint` parameter to feedback:

```solidity
// OLD
function giveFeedback(
  uint256 agentId, 
  uint8 score, 
  bytes32 tag1, 
  bytes32 tag2, 
  string fileuri, 
  bytes32 filehash, 
  bytes feedbackAuth
) external

// NEW
function giveFeedback(
  uint256 agentId, 
  uint8 score, 
  string tag1,        // Changed type
  string tag2,        // Changed type
  string endpoint,    // NEW parameter
  string feedbackURI, // Renamed
  bytes32 feedbackHash // Renamed
) external
```

### Updated `giveFeedback()` Implementation

```typescript
// âœ… v1.0 IMPLEMENTATION
async giveFeedback(
  agentId: AgentId,
  feedbackFile: Record<string, unknown>
): Promise<Feedback> {
  const { tokenId } = parseAgentId(agentId);
  
  // Extract fields - tags are now strings directly
  const score = feedbackFile.score as number;
  const tag1 = (feedbackFile.tag1 as string) || '';
  const tag2 = (feedbackFile.tag2 as string) || '';
  const endpoint = (feedbackFile.endpoint as string) || '';  // NEW
  
  // Upload to IPFS if needed
  let feedbackURI = '';
  let feedbackHash = ethers.ZeroHash;
  if (this._ipfsClient) {
    const cid = await this._ipfsClient.addJson(feedbackFile);
    feedbackURI = `ipfs://${cid}`;
    // Hash not required for IPFS URIs
  }
  
  // Call contract - NO feedbackAuth!
  await this._web3Client.transactContract(
    this._reputationRegistry!,
    'giveFeedback',
    {},
    BigInt(tokenId),
    score,
    tag1,          // string
    tag2,          // string
    endpoint,      // NEW
    feedbackURI,
    feedbackHash
  );
  
  // ... return feedback object
}
```

### NewFeedback Event Changes

```solidity
// OLD
event NewFeedback(
  uint256 indexed agentId, 
  address indexed clientAddress, 
  uint8 score, 
  bytes32 indexed tag1, 
  bytes32 tag2, 
  string fileuri, 
  bytes32 filehash
)

// NEW
event NewFeedback(
  uint256 indexed agentId, 
  address indexed clientAddress, 
  uint64 feedbackIndex,    // NEW
  uint8 score, 
  string indexed tag1,     // Changed type
  string tag2,             // Changed type
  string endpoint,         // NEW
  string feedbackURI,      // Renamed
  bytes32 feedbackHash     // Renamed
)
```

---

## File-by-File Analysis

### 1. `src/core/contracts.ts` ğŸ”´ CRITICAL

**Identity Registry ABI Updates:**

```typescript
// ADD these functions
{
  name: 'setAgentURI',  // Renamed from setTokenURI
  inputs: [
    { name: 'agentId', type: 'uint256' },
    { name: 'newURI', type: 'string' }
  ],
  outputs: [],
  type: 'function'
},
{
  name: 'setAgentWallet',  // NEW
  inputs: [
    { name: 'agentId', type: 'uint256' },
    { name: 'newWallet', type: 'address' },
    { name: 'deadline', type: 'uint256' },
    { name: 'signature', type: 'bytes' }
  ],
  outputs: [],
  type: 'function'
},
{
  name: 'getAgentWallet',  // NEW
  inputs: [{ name: 'agentId', type: 'uint256' }],
  outputs: [{ name: '', type: 'address' }],
  type: 'function'
},

// ADD this event
{
  name: 'URIUpdated',  // NEW
  inputs: [
    { name: 'agentId', type: 'uint256', indexed: true },
    { name: 'newURI', type: 'string', indexed: false },
    { name: 'updatedBy', type: 'address', indexed: true }
  ],
  type: 'event'
}
```

**Reputation Registry ABI Updates:**

```typescript
// UPDATE giveFeedback
{
  name: 'giveFeedback',
  inputs: [
    { name: 'agentId', type: 'uint256' },
    { name: 'score', type: 'uint8' },
    { name: 'tag1', type: 'string' },     // Was bytes32
    { name: 'tag2', type: 'string' },     // Was bytes32
    { name: 'endpoint', type: 'string' }, // NEW
    { name: 'feedbackURI', type: 'string' },  // Renamed
    { name: 'feedbackHash', type: 'bytes32' } // Renamed
    // REMOVED: feedbackAuth
  ],
  outputs: [],
  type: 'function'
},

// UPDATE readFeedback
{
  name: 'readFeedback',
  inputs: [
    { name: 'agentId', type: 'uint256' },
    { name: 'clientAddress', type: 'address' },
    { name: 'feedbackIndex', type: 'uint64' }  // Renamed from 'index'
  ],
  outputs: [
    { name: 'score', type: 'uint8' },
    { name: 'tag1', type: 'string' },   // Was bytes32
    { name: 'tag2', type: 'string' },   // Was bytes32
    { name: 'isRevoked', type: 'bool' }
  ],
  type: 'function'
},

// UPDATE getSummary
{
  name: 'getSummary',
  inputs: [
    { name: 'agentId', type: 'uint256' },
    { name: 'clientAddresses', type: 'address[]' },
    { name: 'tag1', type: 'string' },  // Was bytes32
    { name: 'tag2', type: 'string' }   // Was bytes32
  ],
  outputs: [
    { name: 'count', type: 'uint64' },
    { name: 'averageScore', type: 'uint8' }
  ],
  type: 'function'
}
```

### 2. `src/core/agent.ts` ğŸ”´ CRITICAL

**Changes Required:**

| Change | Type |
|--------|------|
| Add `registerOnChain()` method | NEW |
| Rename `setAgentUri()` â†’ `setAgentURI()` | RENAME |
| Rewrite `setAgentWallet()` to async + EIP-712 | BREAKING |
| Update `registerIPFS()` to call `setAgentURI` | UPDATE |
| Remove `agentWallet` from `_collectMetadataForRegistration()` | UPDATE |

### 3. `src/core/feedback-manager.ts` ğŸ”´ CRITICAL

**Remove:**
- `signFeedbackAuth()` method
- `_stringToBytes32()` helper
- `_bytes32ToTags()` helper

**Update:**
- `giveFeedback()` - new signature, add endpoint, remove feedbackAuth
- `getFeedback()` - handle string tags
- `searchFeedback()` - handle string tags

### 4. `src/core/web3-client.ts` ğŸŸ¡ HIGH

**Remove:**
- `encodeFeedbackAuth()` method

**Add:**
- `signTypedData()` method for EIP-712 signing

```typescript
// NEW METHOD
async signTypedData(
  domain: ethers.TypedDataDomain,
  types: Record<string, ethers.TypedDataField[]>,
  value: Record<string, unknown>
): Promise<string> {
  if (!this.signer) {
    throw new Error('No signer available');
  }
  return await this.signer.signTypedData(domain, types, value);
}
```

### 5. `src/models/interfaces.ts` ğŸŸ¡ HIGH

**Update Feedback interface:**

```typescript
interface Feedback {
  agentId: AgentId;
  clientAddress: Address;
  feedbackIndex: number;
  score: number;
  tag1?: string;
  tag2?: string;
  endpoint?: string;     // NEW in v1.0
  domain?: string;       // NEW in v1.0 (OASF domain)
  feedbackURI?: string;  // Renamed from fileUri
  feedbackHash?: string; // Renamed from fileHash
  isRevoked: boolean;
  // ... other fields
}
```

**Update SearchFeedbackParams:**

```typescript
interface SearchFeedbackParams {
  agents?: AgentId[];
  tags?: string[];
  endpoints?: string[];   // NEW
  domains?: string[];     // NEW
  // ... other fields
}
```

### 6. `src/core/sdk.ts` ğŸŸ¢ MEDIUM

**Remove:**
- `signFeedbackAuth()` method (delegates to FeedbackManager)

**Update:**
- `giveFeedback()` - remove feedbackAuth parameter

---

## Migration Guide

### Phase 1: ABI Updates (CRITICAL)

1. **Update `contracts.ts`**:
   - Add `setAgentURI`, `setAgentWallet`, `getAgentWallet` to Identity Registry
   - Add `URIUpdated` event
   - Update Reputation Registry: change tag types, add endpoint, remove feedbackAuth
   - Update event signatures

### Phase 2: Registration Flow Updates

1. **Update `agent.ts`**:
   - Add `registerOnChain()` method for data URI registration
   - Rename internal calls from `setAgentUri` to `setAgentURI`
   - Remove `agentWallet` from metadata collection

2. **Update `ipfs-client.ts`**:
   - Remove `agentWallet` from endpoints in registration file
   - (Wallet is now on-chain only, not in IPFS file)

### Phase 3: Agent Wallet Refactor (BREAKING)

1. **Rewrite `setAgentWallet()` in `agent.ts`**:
   - Make it async
   - Implement EIP-712 signature generation
   - Call new contract method

2. **Add `signTypedData()` in `web3-client.ts`**

### Phase 4: Feedback Flow Refactor (BREAKING)

1. **Remove from `feedback-manager.ts`**:
   - `signFeedbackAuth()`
   - `_stringToBytes32()`
   - `_bytes32ToTags()`

2. **Remove from `web3-client.ts`**:
   - `encodeFeedbackAuth()`

3. **Update `giveFeedback()` in `feedback-manager.ts`**:
   - Pass tags as strings directly
   - Add endpoint parameter
   - Remove feedbackAuth handling

4. **Update `getFeedback()`, `searchFeedback()`**:
   - Handle string tags directly

### Phase 5: Interface Updates

1. **Update `interfaces.ts`**:
   - Add `endpoint` and `domain` to Feedback
   - Update SearchFeedbackParams
   - Rename `fileUri` â†’ `feedbackURI`, `fileHash` â†’ `feedbackHash`

### Phase 6: Testing

1. Deploy to testnet with new contract ABIs
2. Test all three registration flows (IPFS, HTTP, On-chain)
3. Test feedback flow with new parameters
4. Test wallet signature verification
5. Test URI update flow with new event

---

## Checklist

- [ ] Update Identity Registry ABI
- [ ] Update Reputation Registry ABI
- [ ] Add `registerOnChain()` method
- [ ] Rename `setAgentUri()` â†’ `setAgentURI()`
- [ ] Rewrite `setAgentWallet()` with EIP-712
- [ ] Add `signTypedData()` to web3-client
- [ ] Remove `signFeedbackAuth()` and helpers
- [ ] Remove `encodeFeedbackAuth()`
- [ ] Update `giveFeedback()` signature
- [ ] Update interfaces
- [ ] Update subgraph queries (if tag types changed)
- [ ] Write migration tests
- [ ] Update documentation

---

*Last updated: January 2026 - Based on ERC-8004 v1.0*
